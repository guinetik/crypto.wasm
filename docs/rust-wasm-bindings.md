# WASM Bindings

> How Rust exposes functionality to JavaScript via wasm-bindgen

## Conditional Attributes

```rust
#[cfg_attr(target_arch = "wasm32", wasm_bindgen)]
```

This attribute:
- **WASM build**: Applies `#[wasm_bindgen]` to expose to JS
- **Native build**: No attribute, normal Rust struct

## Exposed Types

### EncryptorType Enum

```rust
#[wasm_bindgen]
pub enum EncryptorType {
    Aes128,
    Base64,
}
```

In JavaScript:
```javascript
EncryptorType.Aes128  // 0
EncryptorType.Base64  // 1
```

### CryptoWasm Struct

```rust
#[cfg_attr(target_arch = "wasm32", wasm_bindgen)]
pub struct CryptoWasm {
    encryptor: Box<dyn Encryptor>,
}
```

## Exposed Methods

### Constructor

```rust
#[cfg_attr(target_arch = "wasm32", wasm_bindgen(constructor))]
pub fn new(secret_key: String, encryptor_type: EncryptorType) -> CryptoWasm
```

JavaScript:
```javascript
const crypto = new CryptoWasm("thisisasecretkey", EncryptorType.Aes128);
```

### cypher

```rust
#[cfg_attr(target_arch = "wasm32", wasm_bindgen)]
pub fn cypher(&self, input: &str) -> String
```

### decypher

```rust
#[cfg_attr(target_arch = "wasm32", wasm_bindgen)]
pub fn decypher(&self, encrypted_input: &str) -> Result<String, String>
```

Returns `Result` which becomes a thrown exception in JS on error.

## Memory Management

The `free()` method is auto-generated by wasm-bindgen:
```javascript
crypto.free();  // Release WASM memory
```

## Build Output

```
dist/crypto_wasm/
├── crypto_wasm.lib.min.js   # JS glue code
├── crypto_wasm_bg.wasm      # WASM binary
└── crypto_wasm.d.ts         # TypeScript types
```

## Links

- [JS Wrapper](./js-wrapper.md) - JavaScript wrapper using these bindings
- [Rust Overview](./rust-overview.md) - Rust implementation details
